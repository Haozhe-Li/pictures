<div align="center">

# ğŸ“¸ Pictures

### é¢å‘æ‘„å½±å¸ˆçš„ AI é©±åŠ¨å¤šæ¨¡æ€å›¾åº“

[![åœ¨çº¿æ¼”ç¤º](https://img.shields.io/badge/ğŸŒ_åœ¨çº¿æ¼”ç¤º-haozheli.pictures-blue?style=for-the-badge)](https://www.haozheli.pictures/)

[English](README.md) | [ç®€ä½“ä¸­æ–‡](README_ZH.md)

![Python](https://img.shields.io/badge/Python-3.10%2B-3776AB?style=flat-square&logo=python&logoColor=white)
![FastAPI](https://img.shields.io/badge/FastAPI-009688?style=flat-square&logo=fastapi&logoColor=white)
![Next.js](https://img.shields.io/badge/Next.js-14-000000?style=flat-square&logo=next.js&logoColor=white)
![TypeScript](https://img.shields.io/badge/TypeScript-3178C6?style=flat-square&logo=typescript&logoColor=white)
![Redis](https://img.shields.io/badge/Redis-DC382D?style=flat-square&logo=redis&logoColor=white)
![Qdrant](https://img.shields.io/badge/Qdrant-1E1E1E?style=flat-square&logo=qdrant&logoColor=white)
![Cloudflare R2](https://img.shields.io/badge/Cloudflare_R2-F38020?style=flat-square&logo=cloudflare&logoColor=white)

**Pictures** æ˜¯ä¸€ä¸ªç”Ÿäº§å°±ç»ªçš„å¤šæ¨¡æ€ã€å¤šè¯­è¨€å›¾åº“ï¼Œç»“åˆäº†æ··åˆæ£€ç´¢ï¼ˆç¨€ç– + ç¨ å¯†ï¼‰å’Œæ™ºèƒ½ç¼“å­˜ï¼Œå¯ä»è‡ªç„¶è¯­è¨€æˆ–å›¾åƒä¸­æä¾›å¿«é€Ÿã€å‡†ç¡®çš„æœç´¢ç»“æœã€‚

![ä¸»é¡µæ¼”ç¤º](assets/pictures-home.gif)

[åŠŸèƒ½ç‰¹æ€§](#-åŠŸèƒ½ç‰¹æ€§) â€¢ [æ¶æ„](#ï¸-æ¶æ„) â€¢ [æŠ€æœ¯æ ˆ](#ï¸-æŠ€æœ¯æ ˆ) â€¢ [å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹) â€¢ [é…ç½®](#ï¸-é…ç½®) â€¢ [éƒ¨ç½²](#-éƒ¨ç½²)

</div>

---

## âœ¨ åŠŸèƒ½ç‰¹æ€§

### ğŸ” è‡ªç„¶è¯­è¨€æœç´¢

ç”±æ··åˆç¨€ç–+ç¨ å¯†æ£€ç´¢é©±åŠ¨ï¼Œæä¾›å‡†ç¡®ã€ä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„ç»“æœã€‚

![è‡ªç„¶è¯­è¨€æœç´¢](assets/pictures-search.gif)

### ğŸŒ å¤šè¯­è¨€æ”¯æŒ

æ”¯æŒä»»ä½•è¯­è¨€æœç´¢ â€” æ— è¯­è¨€éšœç¢ï¼Œç”± CLIP åµŒå…¥é©±åŠ¨ã€‚

![å¤šè¯­è¨€æœç´¢](assets/pictures-multilingual.gif)

### ğŸ–¼ï¸ ä»¥å›¾æœå›¾

ä½¿ç”¨å…ˆè¿›çš„è§†è§‰åµŒå…¥æŠ€æœ¯æŸ¥æ‰¾è§†è§‰ç›¸ä¼¼çš„ç…§ç‰‡ã€‚

![ä»¥å›¾æœå›¾](assets/pictures-similar.gif)

### ğŸ² æ™ºèƒ½æ¨è

é€šè¿‡æ™ºèƒ½éšæœºæ¨èå‘ç°æ–°ç…§ç‰‡ã€‚

![éšæœºæ¨è](assets/pictures-random-search.gif)

### âš¡ é«˜æ€§èƒ½

å¤šå±‚ç¼“å­˜æ¶æ„æœ€å¤§é™åº¦åœ°å‡å°‘å»¶è¿Ÿå¹¶é™ä½å¤§è§„æ¨¡æˆæœ¬ã€‚

---

## ğŸ—ï¸ æ¶æ„

### æ··åˆæ£€ç´¢

Pictures ä½¿ç”¨å¤æ‚çš„æ··åˆæ£€ç´¢ç³»ç»Ÿï¼Œç»“åˆäº†ï¼š

![æ··åˆæ£€ç´¢æµç¨‹](https://cdn.haozheli.com/pictures-flow-chart.webp)

1. **ç¨€ç–æ£€ç´¢ (BM25)** â€” åŸºäºå…³é”®è¯çš„å…ƒæ•°æ®åŒ¹é…
2. **ç¨ å¯†æ£€ç´¢ (CLIP)** â€” è¯­ä¹‰æ–‡æœ¬å’Œå›¾åƒåµŒå…¥
3. **å‘é‡å­˜å‚¨ (Qdrant)** â€” é«˜æ•ˆç›¸ä¼¼æ€§æœç´¢
4. **æ’åèåˆ (RRF)** â€” å€’æ•°æ’åèåˆä»¥è·å¾—æœ€ä½³ç»“æœ

### å¤šå±‚ç¼“å­˜

æ™ºèƒ½ç¼“å­˜å‡å°‘å»¶è¿Ÿå’Œ API æˆæœ¬ï¼š

![å¤šå±‚ç¼“å­˜](https://cdn.haozheli.com/pictures-cache-layer.webp)

- **ç¬¬ä¸€å±‚ï¼š** å‰ç«¯ç¼“å­˜ï¼ˆNext.js + Upstash Redisï¼‰
- **ç¬¬äºŒå±‚ï¼š** åç«¯æœåŠ¡ç¼“å­˜
- **ç¬¬ä¸‰å±‚ï¼š** åµŒå…¥ç¼“å­˜ï¼ˆæŸ¥è¯¢å‘é‡ï¼‰

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### åç«¯

- **æ¡†æ¶ï¼š** FastAPI (Python 3.10+)
- **å‘é‡æ•°æ®åº“ï¼š** Qdrant
- **åµŒå…¥ï¼š** CLIP (OpenAI), Jina AI
- **æ£€ç´¢ï¼š** BM25 + ç¨ å¯†å‘é‡æœç´¢
- **ç¼“å­˜ï¼š** Redis
- **å­˜å‚¨ï¼š** Cloudflare R2

### å‰ç«¯

- **æ¡†æ¶ï¼š** Next.js 14 (App Router)
- **è¯­è¨€ï¼š** TypeScript
- **æ ·å¼ï¼š** Tailwind CSS
- **UI ç»„ä»¶ï¼š** Radix UI + shadcn/ui
- **ç¼“å­˜ï¼š** Upstash Redis
- **éƒ¨ç½²ï¼š** Vercel

### åŸºç¡€è®¾æ–½

- **CDNï¼š** Cloudflare
- **å®¹å™¨ï¼š** Docker
- **ç›‘æ§ï¼š** å†…ç½®æ—¥å¿—

---

## ğŸ“‚ é¡¹ç›®ç»“æ„

```
gallery_RAG/
â”œâ”€â”€ backend/                 # FastAPI åç«¯æœåŠ¡
â”‚   â”œâ”€â”€ main.py             # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ requirements.txt    # Python ä¾èµ–
â”‚   â”œâ”€â”€ Dockerfile          # å®¹å™¨é…ç½®
â”‚   â”œâ”€â”€ core/               # æ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ config.py       # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ db.py           # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â”œâ”€â”€ embedding.py    # åµŒå…¥ç”Ÿæˆ
â”‚   â”‚   â”œâ”€â”€ storage.py      # R2 å­˜å‚¨é›†æˆ
â”‚   â”‚   â””â”€â”€ utils.py        # å·¥å…·å‡½æ•°
â”‚   â””â”€â”€ models/             # æ¨¡å‹æ–‡ä»¶
â”œâ”€â”€ frontend/               # Next.js å›¾åº“åº”ç”¨
â”‚   â”œâ”€â”€ app/                # App è·¯ç”±é¡µé¢
â”‚   â”‚   â”œâ”€â”€ page.tsx        # ä¸»é¡µ
â”‚   â”‚   â””â”€â”€ api/            # API è·¯ç”±
â”‚   â”œâ”€â”€ components/         # React ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ gallery.tsx
â”‚   â”‚   â”œâ”€â”€ search-bar.tsx
â”‚   â”‚   â””â”€â”€ ui/             # UI åŸºç¡€ç»„ä»¶
â”‚   â””â”€â”€ lib/                # å·¥å…·åº“
â”‚       â”œâ”€â”€ api.ts          # API å®¢æˆ·ç«¯
â”‚       â””â”€â”€ types.ts        # TypeScript ç±»å‹
â”œâ”€â”€ upload_GUI/             # ç®¡ç†ä¸Šä¼ ç•Œé¢
â”‚   â”œâ”€â”€ app/                # ä¸Šä¼ åº”ç”¨é¡µé¢
â”‚   â””â”€â”€ components/         # ä¸Šä¼ ç»„ä»¶
â””â”€â”€ assets/                 # æ–‡æ¡£èµ„æº
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- **Python** 3.10 æˆ–æ›´é«˜ç‰ˆæœ¬
- **Node.js** 18 æˆ–æ›´é«˜ç‰ˆæœ¬
- **pnpm**ï¼ˆæ¨èï¼‰æˆ– npm
- **Docker**ï¼ˆå¯é€‰ï¼Œç”¨äºå®¹å™¨åŒ–éƒ¨ç½²ï¼‰
- **Redis** å®ä¾‹ï¼ˆæœ¬åœ°æˆ–äº‘ç«¯ï¼‰
- **Qdrant** å®ä¾‹ï¼ˆæœ¬åœ°æˆ–äº‘ç«¯ï¼‰

### åç«¯è®¾ç½®

1. **å…‹éš†ä»“åº“**

   ```bash
   git clone https://github.com/yourusername/gallery_RAG.git
   cd gallery_RAG/backend
   ```

2. **å®‰è£…ä¾èµ–**

   ```bash
   pip install -r requirements.txt
   ```

3. **é…ç½®ç¯å¢ƒå˜é‡**

   ```bash
   cp .env.example .env
   # ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„ API å¯†é’¥å’Œé…ç½®
   ```

4. **è¿è¡Œåç«¯**

   ```bash
   uvicorn main:app --reload --host 0.0.0.0 --port 8000
   ```

   æˆ–ä½¿ç”¨ Dockerï¼š

   ```bash
   docker build -t pictures-backend .
   docker run -p 8000:8000 --env-file .env pictures-backend
   ```

### å‰ç«¯è®¾ç½®

1. **è¿›å…¥å‰ç«¯ç›®å½•**

   ```bash
   cd frontend
   ```

2. **å®‰è£…ä¾èµ–**

   ```bash
   pnpm install
   ```

3. **é…ç½®ç¯å¢ƒå˜é‡**

   ```bash
   cp .env.example .env.local
   # ç¼–è¾‘ .env.local æ–‡ä»¶å¡«å…¥é…ç½®
   ```

4. **è¿è¡Œå¼€å‘æœåŠ¡å™¨**

   ```bash
   pnpm dev
   ```

   åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ [http://localhost:3000](http://localhost:3000)ã€‚

### ä¸Šä¼ ç•Œé¢è®¾ç½®

1. **è¿›å…¥ä¸Šä¼ ç•Œé¢ç›®å½•**

   ```bash
   cd upload_GUI
   ```

2. **å®‰è£…ä¾èµ–**

   ```bash
   pnpm install
   ```

3. **é…ç½®ç¯å¢ƒå˜é‡**

   ```bash
   cp .env.example .env.local
   # è®¾ç½® BACKEND_URL ä¸ºä½ çš„åç«¯ URL
   ```

4. **è¿è¡Œä¸Šä¼ ç•Œé¢**
   ```bash
   pnpm dev
   ```

---

## âš™ï¸ é…ç½®

### åç«¯ç¯å¢ƒå˜é‡

åœ¨ `backend/` ç›®å½•ä¸­åˆ›å»º `.env` æ–‡ä»¶ï¼š

| å˜é‡                | æè¿°                                         | å¿…éœ€ |
| ------------------- | -------------------------------------------- | ---- |
| `CF_API_URL`        | Cloudflare R2 S3 ç«¯ç‚¹ URL                    | âœ…   |
| `CF_API_KEY_ID`     | R2 è®¿é—®å¯†é’¥ ID                               | âœ…   |
| `CF_API_KEY_SECRET` | R2 è®¿é—®å¯†é’¥å¯†æ–‡                              | âœ…   |
| `QDRANT_URL`        | Qdrant ç«¯ç‚¹ï¼ˆé»˜è®¤ï¼š`http://localhost:6333`ï¼‰ | âœ…   |
| `QDRANT_API_KEY`    | Qdrant API å¯†é’¥ï¼ˆå¦‚æœä½¿ç”¨äº‘ç«¯ï¼‰              | âš ï¸   |
| `JINA_API_KEY`      | Jina AI åµŒå…¥ API å¯†é’¥                        | âœ…   |
| `REDIS_HOST`        | Redis ä¸»æœºåœ°å€                               | âœ…   |
| `REDIS_PORT`        | Redis ç«¯å£ï¼ˆé»˜è®¤ï¼š`16666`ï¼‰                  | âœ…   |
| `REDIS_USERNAME`    | Redis ç”¨æˆ·åï¼ˆé»˜è®¤ï¼š`default`ï¼‰              | âœ…   |
| `REDIS_PASSWORD`    | Redis å¯†ç                                    | âœ…   |
| `ADMIN_USERNAME`    | `/ingest` ç«¯ç‚¹çš„åŸºæœ¬è®¤è¯ç”¨æˆ·å               | âœ…   |
| `ADMIN_PASSWORD`    | `/ingest` ç«¯ç‚¹çš„åŸºæœ¬è®¤è¯å¯†ç                  | âœ…   |

### å‰ç«¯ç¯å¢ƒå˜é‡

åœ¨ `frontend/` ç›®å½•ä¸­åˆ›å»º `.env.local` æ–‡ä»¶ï¼š

| å˜é‡                   | æè¿°                                          | å¿…éœ€ |
| ---------------------- | --------------------------------------------- | ---- |
| `GALLERY_API_BASE_URL` | åç«¯åŸºç¡€ URLï¼ˆä¾‹å¦‚ï¼š`http://localhost:8000`ï¼‰ | âœ…   |
| `KV_REST_API_URL`      | Upstash Redis REST API URL                    | âœ…   |
| `KV_REST_API_TOKEN`    | Upstash Redis REST API ä»¤ç‰Œ                   | âœ…   |

### ä¸Šä¼ ç•Œé¢ç¯å¢ƒå˜é‡

åœ¨ `upload_GUI/` ç›®å½•ä¸­åˆ›å»º `.env.local` æ–‡ä»¶ï¼š

| å˜é‡          | æè¿°                   | å¿…éœ€ |
| ------------- | ---------------------- | ---- |
| `BACKEND_URL` | å›¾åƒæ‘„å–çš„åç«¯åŸºç¡€ URL | âœ…   |

---

## ğŸ“š API æ–‡æ¡£

å®Œæ•´çš„ API æ–‡æ¡£è¯·å‚è§ [backend/API.md](backend/API.md)ã€‚

### ä¸»è¦ç«¯ç‚¹

- `GET /gallery` â€” è·å–æ‰€æœ‰å›¾åº“å›¾åƒ
- `POST /search` â€” æŒ‰æ–‡æœ¬æŸ¥è¯¢æœç´¢å›¾åƒ
- `POST /similar` â€” æŒ‰å›¾åƒ URL æŸ¥æ‰¾ç›¸ä¼¼å›¾åƒ
- `GET /random-query` â€” è·å–éšæœºæœç´¢å»ºè®®
- `POST /ingest` â€” ä¸Šä¼ å¹¶å¤„ç†æ–°å›¾åƒï¼ˆä»…ç®¡ç†å‘˜ï¼‰

æœ‰å…³è¯¦ç»†çš„è¯·æ±‚/å“åº”æ¶æ„å’Œç¤ºä¾‹ï¼Œè¯·å‚é˜… [API æ–‡æ¡£](backend/API.md)ã€‚

---

## ğŸš¢ éƒ¨ç½²

### ç”Ÿäº§æ¶æ„

- **å‰ç«¯ï¼š** éƒ¨ç½²åœ¨ Vercelï¼Œå¸¦æœ‰è¾¹ç¼˜ç¼“å­˜
- **åç«¯ï¼š** å®¹å™¨åŒ–éƒ¨ç½²ï¼ˆDockerï¼‰åœ¨ä»»ä½•äº‘æä¾›å•†
- **å­˜å‚¨ï¼š** Cloudflare R2 with CDN
- **å‘é‡æ•°æ®åº“ï¼š** Qdrant Cloud æˆ–è‡ªæ‰˜ç®¡
- **ç¼“å­˜ï¼š** Upstash Redisï¼ˆå‰ç«¯ï¼‰+ Redisï¼ˆåç«¯ï¼‰

### åç«¯éƒ¨ç½²ï¼ˆDockerï¼‰

```bash
cd backend

# æ„å»º Docker é•œåƒ
docker build -t pictures-backend .

# è¿è¡Œå®¹å™¨
docker run -d \
  -p 8000:8000 \
  --env-file .env \
  --name pictures-backend \
  pictures-backend
```

### å‰ç«¯éƒ¨ç½²ï¼ˆVercelï¼‰

1. **æ¨é€åˆ° GitHub**

   ```bash
   git push origin main
   ```

2. **å¯¼å…¥åˆ° Vercel**
   - è®¿é—® [vercel.com](https://vercel.com)
   - å¯¼å…¥ä½ çš„ä»“åº“
   - è®¾ç½®æ ¹ç›®å½•ä¸º `frontend/`
   - ä» `.env.local` æ·»åŠ ç¯å¢ƒå˜é‡

3. **éƒ¨ç½²**
   - Vercel ä¼šåœ¨æ¯æ¬¡æ¨é€åˆ° `main` æ—¶è‡ªåŠ¨éƒ¨ç½²

### ä¸Šä¼ ç•Œé¢éƒ¨ç½²

ä¸Šä¼ ç•Œé¢å¯ä»¥åƒå‰ç«¯ä¸€æ ·éƒ¨ç½²ï¼Œæˆ–ä»…ä¸ºç®¡ç†å‘˜ä½¿ç”¨åœ¨æœ¬åœ°æ‰˜ç®¡ã€‚ç¡®ä¿æ­£ç¡®é…ç½® HTTP åŸºæœ¬è®¤è¯å‡­æ®ã€‚

---

## ğŸ“„ è®¸å¯è¯

è¯¥é¡¹ç›®ç›®å‰æœªæˆæƒã€‚å¦‚æœä½ è®¡åˆ’å¼€æºæ­¤é¡¹ç›®ï¼Œè¯·æ·»åŠ  LICENSE æ–‡ä»¶ï¼ˆMITã€Apache 2.0 ç­‰ï¼‰ã€‚

---

<div align="center">
**ç”± Haozhe Li ç”¨ â¤ï¸ æ„å»º**

[â¬† è¿”å›é¡¶éƒ¨](#-pictures)

</div>
